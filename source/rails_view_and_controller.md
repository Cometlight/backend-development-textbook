Rails Views and Controller
==========================

The Rails View is concerened with displaying (HTML and JSON) output. The
controller is concerned with handling incoming requests,
and using the model and views to generate a result.

After reading this guide you should

* understand the role of view, controller and routing in rails
* know which routes and actions are implied by rails resources

and be able to 

* adapt the views and controllers generated by the scaffold generator
* build a form for editing a model
* use nested resources

-------------------------------------------------------

The View
--------

The View in the Model-View-Controller pattern
is responsible for generating output that will be
displayed the user in various ways.

In Ruby on Rails **Embedded Ruby** (ERB) is normally used
as the templating languages to define the views.  If you have
used templates in other languages or have used PHP embedded in HTML
than you will recognize the similarities.

Both Web Designers and Web Developers might want to edit
the files concerning the view. (This is one of the points where
using git to relove merge conflicts comes in handy!).

### layouts and views


![Layouts and Views](images/layout_view.svg)


![Layouts, Views and Partials](images/layout_view_partial.svg)

### rails views

* are stored in `app/views/<name of controller>/*.html.erb`
* template format `.erb` is html with embedded ruby:
* `<% ruby code here %>` just evaluates the code
* `<%= ruby code here %>` evaluates the code and includes result
* main template (for header, footer) in `app/views/layouts/application.html.erb`
* `yield`s to include single view


### static content

* anything placed in `public`
* is directly accessible in the web space, without going through rails!


### links

* never write links to your own app "by hand"!
* use helper methods to get the right URLs
* `link_to 'link text here', object` links to show action of the object
* use `rake routes` to find out the names of urls/paths


### Now do 'Rails for Zombies' Episode no3

![Rails for Zombies Episode 3](images/rails-for-zombies-3.jpg)

The Controller
--------------

The controller is the central part of MVC. One Controller gets
called for every HTTP request. The controller than uses the model(s)
to load and manipulate the right data, and finally displays the resulting
page by rendering a view.


### restful resources

a rails convention about which http methods and urls
you should use, and which controllers and methods you should use.

in `config/routes.rb`  

``` ruby
resources :zombies
```


![scaffold](images/rest.png)


``` 
GET    /zombies          zombies_controller def index
POST   /zombies          zombies_controller def create
GET    /zombies/new      zombies_controller def new
GET    /zombies/:id/edit zombies_controller def edit
GET    /zombies/:id      zombies_controller def show
PUT    /zombies/:id      zombies_controller def update
DELETE /zombies/:id      zombies_controller def destroy
```



### Now do 'Rails for Zombies' Episode no 4

![Rails for Zombies Episode 4](images/rails-for-zombies-4.jpg)


Nested Resources
-------

* one model belongs to another, and is dependent
* `has_many :cards, :dependent => :destroy`
* makes sense to nest urls:
* /boards/3/cards  - all the cards in board 3

### model:

* `has_many :cards, :dependent => :destroy`

### routes file:

``` ruby
resources :boards do
  resources :cards
end
```

### Routes constructed by nested resources

``` sh
GET    /boards                          
POST   /boards                          
GET    /boards/new                      
GET    /boards/:id/edit                 
GET    /boards/:id                      
PUT    /boards/:id                      
DELETE /boards/:id                      
GET    /boards/:board_id/cards          
POST   /boards/:board_id/cards          
GET    /boards/:board_id/cards/new      
GET    /boards/:board_id/cards/:id/edit 
GET    /boards/:board_id/cards/:id      
PUT    /boards/:board_id/cards/:id      
DELETE /boards/:board_id/cards/:id      
```

### Changes

If you switch to nested resources you need to change
a lot of links:  Instead of `cards_path` you will need `boards_cards_path(board)`.

Another change is needed in the form for editing or creating a card:

``` ruby
<%= form_for  [ @board, @card ]  do |f| %>
```

Form Helpers
-------

When you write a Rails App, you never write `form`- or `input`-Tags by hand.
You always use form helpers to contruct the HTML for you.  You gain a lot of
functionality by using the helpers, but you also need to understand how they work.



Further reading
----------------

* Rails Guide: [Layouts and Rendering in Rails](http://guides.rubyonrails.org/layouts_and_rendering.html)
* Rails Guide: [Action Controller Overview](http://guides.rubyonrails.org/action_controller_overview.html)
* Rails Guide: [Rails Routing from the Outside In](http://guides.rubyonrails.org/routing.html)
* [link_to](http://apidock.com/rails/v3.2.8/ActionView/Helpers/UrlHelper/link_to)
* [before_filter](http://apidock.com/rails/AbstractController/Callbacks/ClassMethods/before_filter)
* [resources](http://apidock.com/rails/ActionDispatch/Routing/Mapper/Resources/resources)
